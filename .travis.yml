language: python
# Using default dist and os
dist: xenial
os: linux

python:
  - 3.7.6
  - 3.8

services:
  - postgresql

env:
  - SECRET_KEY="de68z30c(3nbj*k4=lumea8hztcy_6%d0epx^w$jc&s)wygezo" DJANGO_SETTINGS_MODULE="oilandrope.settings"

install:
  - pip install -r requirements/requirements-base.txt -U
  # Install pytest and dependencies
  - pip install -U pytest pytest-django pytest-asyncio pytest-mock model_bakery freezegun
  # Codecov and coverage
  - pip install -U codecov pytest-cov

before_script: psql -c 'create database oilandrope;' -U postgres

jobs:
  include:
    - name: "Python ${TRAVIS_PYTHON_VERSION} syntax check"
      install:
        - pip install -r requirements/requirements-base.txt -U
        - pip install -U flake8
      script: flake8
    - name: "Python ${TRAVIS_PYTHON_VERSION} imports check"
      install:
      - pip install -r requirements/requirements-base.txt -U
      - pip install -U isort
      script: isort --recursive --check-only --diff
    - name: "Python ${TRAVIS_PYTHON_VERSION} Django Checks"
      install: pip install -r requirements/requirements-base.txt -U
      script: python manage.py check
    - name: "NodeJS Tests"
      language: node_js
      node_js: 12
      install: npm install
      script: npm test
      after_success: skip

script: pytest --cov ./ --cov-report xml
after_success: codecov -e DJANGO_SETTINGS_MODULE