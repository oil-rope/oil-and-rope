language: python
# Using default dist and os
dist: xenial
os: linux

python:
  - "python 3.7.6."
  - "python 3.8"

services:
  - postgresql

env:
  - SECRET_KEY="de68z30c(3nbj*k4=lumea8hztcy_6%d0epx^w$jc&s)wygezo" DJANGO_SETTINGS_MODULE="oilandrope.settings"

install:
  - pip install -r requirements/requirements-base.txt -U
  # Linting
  - pip install -U flake8 isort
  # Install pytest and dependencies
  - pip install -U pytest pytest-django pytest-asyncio pytest-mock model_bakery freezegun
  # Codecov and coverage
  - pip install -U codecov pytest-cov

before_script:
  - psql -c 'create database oilandrope;' -U postgres

jobs:
  include:
    - name: "Python 3.7.6 syntax check"
      script: flake8
    - name: "Python 3.7.6 imports check"
      script: isort --recursive --check-only --diff
    - name: "Python 3.7.6 Tests"
      script: pytest --cov ./ --cov-report xml
      after_success: codecov -e DJANGO_SETTINGS_MODULE
    - name: "Python 3.7.6 Django Checks"
      script: python manage.py check
    - name: "Python 3.8 syntax check"
      script: flake8
    - name: "Python 3.8 imports check"
      script: isort --recursive --check-only --diff
    - name: "Python 3.8 Tests"
      script: pytest --cov ./ --cov-report xml
      after_success: codecov -e DJANGO_SETTINGS_MODULE
    - name: "Python 3.8 Django Checks"
      script: python manage.py check
    - name: "NodeJS Tests"
      language: node_js
      node_js: 12
      install:
      - npm install
      before_script:
      - psql -c 'create database oilandrope;' -U postgres
      script:
      - npm test
      after_success: ignore
