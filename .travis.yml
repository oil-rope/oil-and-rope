language: python

services:
  - postgresql


python:
  - "3.7.6"
  - "3.8"

env:
  - SECRET_KEY="de68z30c(3nbj*k4=lumea8hztcy_6%d0epx^w$jc&s)wygezo" DJANGO_SETTINGS_MODULE="oilandrope.settings"

install:
  - pip install -r requirements/requirements-base.txt
  # Linting
  - pip install flake8 isort
  # Install pytest and dependencies
  - pip install pytest pytest-django pytest-asyncio pytest-mock model_bakery
  # Codecov and coverage
  - pip install codecov pytest-cov

before_script:
  - psql -c 'create database oilandrope;' -U postgres
  # Fixing isort on migrations
  - isort -sk ./**/migrations/*.py

script:
  - python runtests.py --coverage

after_success:
  - codecov -e DJANGO_SETTINGS_MODULE

jobs:
  include:
    - language: node_js
      before_install:
      - sudo apt-get update
      - sudo apt-get install python3 python3-pip
      - pip3 install -U pip setuptools --user
      install:
        - npm install
      node_js: 12
      script:
      - npm test
