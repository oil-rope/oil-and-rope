language: python
cache: pip

# Using default dist and os
dist: xenial
os: linux

services: postgresql
env: SECRET_KEY="de68z30c(3nbj*k4=lumea8hztcy_6%d0epx^w$jc&s)wygezo" DJANGO_SETTINGS_MODULE="oilandrope.settings"
before_script: psql -c 'create database oilandrope;' -U postgres

jobs:
  include:
    - name: "Python 3.7.6 syntax check"
      python: 3.7.6
      install:
        - pip install -r requirements/requirements-base.txt -U
        - pip install -U flake8
      script: flake8 --config=setup.cfg -v
    - name: "Python 3.7.6 imports check"
      python: 3.7.6
      install:
      - pip install -r requirements/requirements-base.txt -U
      - pip install -U isort
      script: isort -rc -sp setup.cfg -c -df
    - name: "Python 3.7.6 Django check"
      python: 3.7.6
      install: pip install -r requirements/requirements-base.txt -U
      script: python manage.py check
    - name: "Python 3.7.6 Tests"
      python: 3.7.6
      install:
        - pip install -r requirements/requirements-base.txt -U
        - pip install -U pytest pytest-django pytest-asyncio pytest-mock model_bakery freezegun codecov pytest-cov
      script: pytest --cov ./ --cov-report xml -v
      after_success: codecov -e DJANGO_SETTINGS_MODULE
    - name: "Python 3.8 syntax check"
      python: 3.8
      install:
        - pip install -r requirements/requirements-base.txt -U
        - pip install -U flake8
      script: flake8 --config=setup.cfg -v
    - name: "Python 3.8 imports check"
      python: 3.8
      install:
        - pip install -r requirements/requirements-base.txt -U
        - pip install -U isort
      script: isort -rc -sp setup.cfg -c -df
    - name: "Python 3.8 Django check"
      python: 3.8
      install: pip install -r requirements/requirements-base.txt -U
      script: python manage.py check
    - name: "Python 3.8 Tests"
      python: 3.8
      install:
        - pip install -r requirements/requirements-base.txt -U
        - pip install -U pytest pytest-django pytest-asyncio pytest-mock model_bakery freezegun codecov pytest-cov
      script: pytest --cov ./ --cov-report xml -v
      after_success: codecov -e DJANGO_SETTINGS_MODULE
    - name: "NodeJS Tests"
      language: node_js
      node_js: 12
      install: npm install
      script: npm test
      after_success: skip
