name: Project checker

on:
  push:
    branches:
    - master
    - develop
    - releases/*
    - test/*
    - feature/*
    - bug/*
  pull_request:
    branches:
    - master
    - develop

jobs:
  python-build:
    runs-on: ubuntu-latest
    strategy:
      max-parallel: 4
      matrix:
        python-version: [3.7, 3.8]

    steps:
    - uses: actions/checkout@v2
    - name: Setup Python ${{ matrix.python-version }}
      uses: actions/setup-python@v1
      with:
        python-version: ${{ matrix.python-version }}
    - name: Install dependencies
      run: pip install -r requirements/requirements-develop.txt
    - name: Linting with Flake8
      run: flake8 --config=setup.cfg
    - name: Run tests
      run: |
        pip install pytest-cov codecov
        pytest -c setup.cfg --ds oilandrope.dev_settings

  npm-build:
    runs-on: ubuntu-latest
    strategy:
      max-parallel: 4
      matrix:
        node_version: ['10.x', '12.x']

    steps:
    - uses: actions/checkout@v2
    - name: Setup NodeJS ${{ matrix.node_version }}
      uses: actions/setup-node@v1
      with:
        node-version: ${{ matrix.node_version }}
    - name: Install dependencies
      run: npm install
    - name: Build and run tests
      run: |
        npm run build
        npm test
